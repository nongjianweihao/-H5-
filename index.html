<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ç‚¹ç‡ƒä½ çš„è¿åŠ¨å°å®‡å®™ - è·³ç»³ä½“èƒ½æŒ‘æˆ˜</title>
    <!-- å¼•å…¥Tailwind CSSæ¡†æ¶ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥Chart.jsç”¨äºç»˜åˆ¶é›·è¾¾å›¾ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- å¼•å…¥Tone.jsç”¨äºç”ŸæˆéŸ³æ•ˆ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        /* ä½¿ç”¨è‡ªå®šä¹‰å­—ä½“ï¼Œè®©é¡µé¢æ›´æœ‰è®¾è®¡æ„Ÿ */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700;900&display=swap');
        body {
            font-family: 'Noto Sans SC', sans-serif;
            -webkit-tap-highlight-color: transparent; /* ç§»é™¤ç§»åŠ¨ç«¯ç‚¹å‡»é«˜äº® */
        }
        /* å®šä¹‰é¡µé¢åˆ‡æ¢çš„åŠ¨ç”»æ•ˆæœ */
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            opacity: 0;
            transform: scale(1.05);
            pointer-events: none; /* é»˜è®¤é¡µé¢ä¸å¯äº¤äº’ */
        }
        .page.active {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto; /*æ¿€æ´»çš„é¡µé¢å¯äº¤äº’ */
        }
        /* è‡ªå®šä¹‰æŒ‰é’®æ ·å¼ï¼Œå¢åŠ åŠ¨æ„Ÿ */
        .btn-energize {
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 5, 0.4);
        }
        .btn-energize:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 107, 5, 0.6);
        }
        .btn-energize:active {
            transform: translateY(1px);
        }
        /* æ•æ·æŒ‘æˆ˜ä¸­åœ†ç‚¹çš„æ ·å¼ */
        .dot {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }
        .dot:active {
            transform: scale(0.9);
        }
        /* æ—¶æœºæŒ‘æˆ˜ä¸­ç§»åŠ¨æ¡çš„æ ·å¼ */
        #timing-bar {
            position: absolute;
            left: 0;
            height: 100%;
            background-color: #fb923c; /* æ©™è‰² */
            animation: move-bar 2s linear infinite alternate;
        }
        @keyframes move-bar {
            from { left: 0; }
            to { left: calc(100% - 20px); }
        }
        /* è¥é”€å¼¹çª—æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 999;
        }
        .modal.active {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            background: #2d3748; /* bg-slate-800 */
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 400px;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal.active .modal-content {
            transform: scale(1);
        }
    </style>
</head>
<body class="overflow-hidden bg-gray-900">

    <div id="app-container" class="relative w-full h-screen max-w-md mx-auto bg-slate-800 text-white">

        <!-- Page 1: å¯åŠ¨é¡µ -->
        <div id="start-page" class="page active flex flex-col justify-center items-center text-center p-8 bg-gradient-to-br from-gray-900 to-slate-800">
            <div class="flex-grow flex flex-col justify-center items-center">
                <h1 class="text-4xl md:text-5xl font-black tracking-wider text-orange-400 drop-shadow-lg">ç‚¹ç‡ƒä½ çš„è¿åŠ¨å°å®‡å®™</h1>
                <p class="mt-4 text-lg md:text-xl text-gray-300">15ç§’ï¼Œæµ‹å‡ºä½ çš„éšè—è¿åŠ¨å¤©èµ‹ï¼</p>
                <p class="text-sm text-gray-400 mt-2">ä½ çš„ååº”é€Ÿåº¦èƒ½è¶…è¶Šå¤šå°‘äººï¼Ÿ</p>
            </div>
            <button id="start-challenge-btn" class="btn-energize w-full py-4 bg-orange-500 rounded-xl text-xl font-bold">æ¥å—æŒ‘æˆ˜ï¼</button>
        </div>

        <!-- Page 2: èº«ä»½é€‰æ‹©é¡µ -->
        <div id="choice-page" class="page flex flex-col justify-center items-center p-8 bg-gradient-to-b from-slate-800 to-gray-900">
            <h2 class="text-3xl font-bold mb-12">è¯·é€‰æ‹©ä½ çš„èº«ä»½</h2>
            <div class="w-full space-y-6">
                <button data-type="child" class="user-choice-btn w-full py-8 bg-blue-500 rounded-xl text-2xl font-bold transition hover:bg-blue-600 transform hover:scale-105">
                    <span class="text-4xl">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
                    <p>æˆ‘æ˜¯å®¶é•¿ï¼Œä¸ºå­©å­æµ‹å¤©èµ‹</p>
                </button>
                <button data-type="adult" class="user-choice-btn w-full py-8 bg-purple-500 rounded-xl text-2xl font-bold transition hover:bg-purple-600 transform hover:scale-105">
                    <span class="text-4xl">ğŸ”¥</span>
                    <p>æˆ‘ä¸ºè‡ªå·±æµ‹æ½œèƒ½</p>
                </button>
            </div>
        </div>

        <!-- Page 3: æŒ‘æˆ˜é¡µ -->
        <div id="challenge-page" class="page flex flex-col justify-between p-4 bg-gray-900">
            <!-- æŒ‘æˆ˜é€šç”¨å¤´éƒ¨ -->
            <div class="text-center p-2 bg-slate-800 rounded-lg">
                <h3 id="challenge-title" class="text-xl font-bold"></h3>
                <div class="w-full bg-gray-700 rounded-full h-2.5 mt-2">
                    <div id="challenge-timer-bar" class="bg-green-500 h-2.5 rounded-full" style="width: 100%"></div>
                </div>
            </div>
            
            <!-- æŒ‘æˆ˜å†…å®¹å®¹å™¨ -->
            <div id="challenge-content" class="flex-grow relative mt-4 rounded-lg bg-slate-800">
                <!-- æ•æ·æŒ‘æˆ˜ -->
                <div id="agility-challenge" class="hidden w-full h-full"></div>
                <!-- è€åŠ›æŒ‘æˆ˜ -->
                <div id="endurance-challenge" class="hidden w-full h-full flex flex-col justify-center items-center">
                    <p class="text-lg mb-4">10ç§’å†…ï¼Œç–¯ç‹‚ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼</p>
                    <button id="endurance-btn" class="w-40 h-40 bg-red-500 rounded-full text-5xl font-black transition transform active:scale-90 flex justify-center items-center shadow-lg shadow-red-500/50">ç‚¹æˆ‘!</button>
                    <p id="endurance-count" class="mt-4 text-3xl font-bold">0</p>
                </div>
                <!-- æ—¶æœºæŒ‘æˆ˜ -->
                <div id="timing-challenge" class="hidden w-full h-full flex flex-col justify-center items-center p-4">
                    <p class="text-lg mb-8 text-center">å½“ç§»åŠ¨æ–¹å—è¿›å…¥<span class="text-green-400 font-bold">ç»¿è‰²åŒºåŸŸ</span>æ—¶ï¼Œç«‹å³ç‚¹å‡»ï¼</p>
                    <div class="w-full h-12 bg-gray-700 rounded-lg relative overflow-hidden">
                        <div class="absolute h-full bg-green-500/50" style="left: 40%; width: 20%;"></div>
                        <div id="timing-bar" class="w-5 h-full rounded"></div>
                    </div>
                    <button id="timing-btn" class="btn-energize w-full mt-12 py-4 bg-orange-500 rounded-xl text-xl font-bold">å°±ç°åœ¨ï¼</button>
                    <p id="timing-feedback" class="mt-4 text-xl font-bold h-8"></p>
                </div>
            </div>
        </div>

        <!-- Page 4: åŠ è½½é¡µ -->
        <div id="loading-page" class="page flex flex-col justify-center items-center bg-gray-900">
            <div class="w-16 h-16 border-4 border-dashed rounded-full animate-spin border-orange-500"></div>
            <p id="loading-text" class="mt-4 text-lg">æ­£åœ¨åˆ†æä½ çš„è¿åŠ¨ç»†èƒ...</p>
        </div>

        <!-- Page 5: ç»“æœé¡µ -->
        <div id="result-page" class="page flex flex-col p-4 bg-gradient-to-br from-gray-900 to-slate-800 overflow-y-auto">
            <div class="text-center">
                <h2 class="text-3xl font-black text-orange-400">ä½ çš„è¿åŠ¨æ½œèƒ½æŠ¥å‘Š</h2>
            </div>
            <div class="my-4 bg-slate-800/50 p-4 rounded-xl text-center">
                <p class="text-lg">ä½ çš„ç§°å·æ˜¯</p>
                <h3 id="result-title" class="text-4xl font-bold text-yellow-300 my-2">--</h3>
                <p id="result-description" class="text-gray-300">--</p>
            </div>
            <div class="my-4 bg-slate-800/50 p-4 rounded-xl">
                <h4 class="text-xl font-bold text-center mb-2">èƒ½åŠ›é›·è¾¾å›¾</h4>
                <canvas id="result-chart"></canvas>
            </div>
            <div class="my-4 bg-slate-800/50 p-4 rounded-xl">
                <h4 class="text-xl font-bold text-center mb-2">ä¸“ä¸šå»ºè®®</h4>
                <p id="result-suggestion" class="text-gray-300">--</p>
            </div>
             <!-- æ–°å¢ï¼šç¤¾ä¼šè®¤åŒ/å­¦å‘˜è¯„ä»· -->
            <div class="my-4 bg-slate-800/50 p-4 rounded-xl">
                <h4 class="text-xl font-bold text-center mb-2">å¬å¬ä»–ä»¬æ€ä¹ˆè¯´</h4>
                <p id="testimonial" class="text-gray-300 text-sm italic text-center">â€œå­©å­åœ¨è¿™é‡Œå­¦è·³ç»³åï¼Œä¸ä»…é•¿é«˜äº†ï¼Œä¹Ÿæ›´è‡ªä¿¡äº†ï¼â€ - å­¦å‘˜å®¶é•¿ ç‹å¥³å£«</p>
            </div>
            <div class="space-y-4 mt-auto pt-4">
                 <!-- æ–°å¢ï¼šç´§è¿«æ„Ÿè¥é”€ -->
                 <p class="text-center text-yellow-400 font-bold mb-2 animate-pulse">æœ¬å‘¨ä»…å‰© <span id="spots-left">7</span> ä¸ªå…è´¹ä½“éªŒåé¢ï¼</p>
                 <button id="open-lead-form-btn" class="w-full py-3 bg-green-500 rounded-xl text-lg font-bold transition hover:bg-green-600">ç«‹å³é”å®šå…è´¹ä½“éªŒåé¢</button>
                 <button id="open-share-modal-btn" class="w-full py-3 bg-blue-500 rounded-xl text-lg font-bold transition hover:bg-blue-600">é‚€è¯·å¥½å‹ï¼Œå‡çº§è¯¾ç¨‹</button>
            </div>
        </div>
    </div>

    <!-- æ–°å¢ï¼šè¥é”€å¼¹çª— - é¢†å–ä½“éªŒè¯¾ -->
    <div id="lead-form-modal" class="modal">
        <div class="modal-content text-center">
            <div id="form-view">
                <h3 class="text-2xl font-bold mb-2 text-green-400">ä»…å·®ä¸€æ­¥ï¼</h3>
                <p class="mb-6">å¡«å†™ä¿¡æ¯ï¼Œç«‹å³é”å®šæ‚¨çš„å…è´¹ä½“éªŒè¯¾</p>
                <input id="user-name" type="text" placeholder="æ‚¨çš„å§“åæˆ–å­©å­å§“å" class="w-full p-3 mb-4 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                <input id="user-phone" type="tel" placeholder="æ‚¨çš„æ‰‹æœºå·ç " class="w-full p-3 mb-6 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                <button id="submit-lead-btn" class="w-full py-3 bg-green-500 rounded-xl text-lg font-bold">ç«‹å³æäº¤</button>
                <button id="close-lead-modal-btn" class="mt-4 text-gray-400 text-sm">æš‚ä¸é¢†å–</button>
            </div>
            <div id="success-view" class="hidden">
                 <h3 class="text-2xl font-bold mb-2 text-green-400">æ­å–œæ‚¨ï¼Œé¢„çº¦æˆåŠŸï¼</h3>
                 <p class="mb-6">æˆ‘ä»¬çš„è¯¾ç¨‹é¡¾é—®å°†åœ¨24å°æ—¶å†…ä¸æ‚¨è”ç³»ï¼Œè¯·æ³¨æ„æ¥å¬ç”µè¯ã€‚</p>
                 <p class="text-sm text-gray-400">æœºæ„åœ°å€ï¼š[è¿™é‡Œå¡«å†™æ‚¨çš„åœ°å€]</p>
                 <p class="text-sm text-gray-400">è”ç³»ç”µè¯ï¼š[è¿™é‡Œå¡«å†™æ‚¨çš„ç”µè¯]</p>
                 <button id="close-success-modal-btn" class="mt-6 w-full py-3 bg-green-500 rounded-xl text-lg font-bold">å¤ªæ£’äº†ï¼</button>
            </div>
        </div>
    </div>

    <!-- æ–°å¢ï¼šè¥é”€å¼¹çª— - åˆ†äº«å¼•å¯¼ -->
    <div id="share-modal" class="modal">
        <div class="modal-content text-center">
            <h3 class="text-2xl font-bold mb-2 text-blue-400">åˆ†äº«å‡çº§ç¦åˆ©ï¼</h3>
            <p class="mb-6">æˆåŠŸé‚€è¯·1ä½å¥½å‹å®ŒæˆæŒ‘æˆ˜ï¼Œæ‚¨çš„ã€å…è´¹ä½“éªŒè¯¾ã€‘å³å¯å‡çº§ä¸ºã€åŒäººç²¾å“è¯¾ã€‘ï¼Œå¿«é‚€è¯·å¥½å‹æˆ–å®¶äººä¸€èµ·æ¥ç©ï¼</p>
            <button id="close-share-modal-btn" class="w-full py-3 bg-blue-500 rounded-xl text-lg font-bold">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>


    <script>
        // --- DOMå…ƒç´ è·å– ---
        const pages = document.querySelectorAll('.page');
        const startBtn = document.getElementById('start-challenge-btn');
        const choiceBtns = document.querySelectorAll('.user-choice-btn');
        const challengeTitle = document.getElementById('challenge-title');
        const challengeTimerBar = document.getElementById('challenge-timer-bar');
        
        // --- æŒ‘æˆ˜ç›¸å…³å…ƒç´  ---
        const agilityContainer = document.getElementById('agility-challenge');
        const enduranceContainer = document.getElementById('endurance-challenge');
        const enduranceBtn = document.getElementById('endurance-btn');
        const enduranceCount = document.getElementById('endurance-count');
        const timingContainer = document.getElementById('timing-challenge');
        const timingBtn = document.getElementById('timing-btn');
        const timingBar = document.getElementById('timing-bar');
        const timingFeedback = document.getElementById('timing-feedback');

        // --- ç»“æœé¡µå…ƒç´  ---
        const resultTitle = document.getElementById('result-title');
        const resultDescription = document.getElementById('result-description');
        const resultSuggestion = document.getElementById('result-suggestion');
        const loadingText = document.getElementById('loading-text');
        const spotsLeftEl = document.getElementById('spots-left');

        // --- è¥é”€å¼¹çª—å…ƒç´  ---
        const leadFormModal = document.getElementById('lead-form-modal');
        const shareModal = document.getElementById('share-modal');
        const openLeadFormBtn = document.getElementById('open-lead-form-btn');
        const closeLeadModalBtn = document.getElementById('close-lead-modal-btn');
        const submitLeadBtn = document.getElementById('submit-lead-btn');
        const openShareModalBtn = document.getElementById('open-share-modal-btn');
        const closeShareModalBtn = document.getElementById('close-share-modal-btn');
        const formView = document.getElementById('form-view');
        const successView = document.getElementById('success-view');
        const closeSuccessModalBtn = document.getElementById('close-success-modal-btn');


        // --- æ¸¸æˆçŠ¶æ€å˜é‡ ---
        let userType = 'adult'; // 'child' or 'adult'
        let scores = { agility: 0, endurance: 0, timing: 0 };
        let currentChallengeIndex = 0;
        const challenges = ['agility', 'endurance', 'timing'];
        let timerInterval;
        let synth; // éŸ³æ•ˆåˆæˆå™¨

        // --- åˆå§‹åŒ–éŸ³æ•ˆ ---
        function initAudio() {
            if (Tone.context.state !== 'running') {
                Tone.start();
            }
            synth = new Tone.Synth().toDestination();
        }

        // --- é¡µé¢åˆ‡æ¢å‡½æ•° ---
        function showPage(pageId) {
            pages.forEach(page => {
                page.classList.toggle('active', page.id === pageId);
            });
        }
        
        // --- å¼¹çª—æ§åˆ¶ ---
        function toggleModal(modal, show) {
            modal.classList.toggle('active', show);
        }

        // --- æŒ‘æˆ˜æµç¨‹æ§åˆ¶ ---
        function startNextChallenge() {
            if (currentChallengeIndex < challenges.length) {
                const challengeName = challenges[currentChallengeIndex];
                switch (challengeName) {
                    case 'agility': startAgilityChallenge(); break;
                    case 'endurance': startEnduranceChallenge(); break;
                    case 'timing': startTimingChallenge(); break;
                }
                currentChallengeIndex++;
            } else {
                showLoadingAndResults();
            }
        }

        // --- æŒ‘æˆ˜1: æ•æ· ---
        function startAgilityChallenge() {
            challengeTitle.textContent = 'æŒ‘æˆ˜1: æ•æ·ååº”';
            agilityContainer.classList.remove('hidden');
            enduranceContainer.classList.add('hidden');
            timingContainer.classList.add('hidden');
            
            let duration = 10000; // 10ç§’
            let nextDot = 1;
            let score = 0;
            
            function createDot() {
                if (agilityContainer.children.length > 0) return; // é˜²æ­¢é‡å¤åˆ›å»º
                if (nextDot > 10) return; // æœ€å¤š10ä¸ªç‚¹
                const dot = document.createElement('div');
                dot.className = 'dot';
                dot.textContent = nextDot;
                const colors = ['bg-blue-500', 'bg-green-500', 'bg-yellow-500', 'bg-purple-500'];
                dot.classList.add(colors[Math.floor(Math.random() * colors.length)]);
                dot.style.top = `${Math.random() * 85 + 5}%`;
                dot.style.left = `${Math.random() * 85 + 5}%`;
                
                dot.onclick = () => {
                    synth.triggerAttackRelease("C5", "8n");
                    score++;
                    dot.remove();
                    setTimeout(createDot, 100); // ç¨ä½œå»¶è¿Ÿå†å‡ºç°ä¸‹ä¸€ä¸ª
                };
                
                agilityContainer.appendChild(dot);
                nextDot++;
            }
            
            createDot();
            runTimer(duration, () => {
                scores.agility = score * 10; // æ¯ä¸ªç‚¹10åˆ†
                agilityContainer.innerHTML = '';
                startNextChallenge();
            });
        }

        // --- æŒ‘æˆ˜2: è€åŠ› ---
        function startEnduranceChallenge() {
            challengeTitle.textContent = 'æŒ‘æˆ˜2: è€åŠ›ç‚¹å‡»';
            agilityContainer.classList.add('hidden');
            enduranceContainer.classList.remove('hidden');
            timingContainer.classList.add('hidden');

            let duration = 10000; // 10ç§’
            let clicks = 0;
            enduranceCount.textContent = '0';
            
            const clickHandler = () => {
                clicks++;
                enduranceCount.textContent = clicks;
                synth.triggerAttackRelease("E4", "16n");
                // æŒ‰é’®åé¦ˆæ•ˆæœ
                enduranceBtn.style.transform = `scale(${1 + clicks * 0.005})`;
            };
            enduranceBtn.addEventListener('click', clickHandler);
            
            runTimer(duration, () => {
                enduranceBtn.removeEventListener('click', clickHandler);
                scores.endurance = Math.min(100, clicks * (userType === 'child' ? 2.5 : 2)); // å„¿ç«¥å¾—åˆ†ç³»æ•°æ›´é«˜
                enduranceBtn.style.transform = 'scale(1)';
                startNextChallenge();
            });
        }

        // --- æŒ‘æˆ˜3: æ—¶æœº ---
        function startTimingChallenge() {
            challengeTitle.textContent = 'æŒ‘æˆ˜3: æ—¶æœºæŒæ§';
            agilityContainer.classList.add('hidden');
            enduranceContainer.classList.add('hidden');
            timingContainer.classList.remove('hidden');
            
            let attempts = 0;
            let totalScore = 0;
            const maxAttempts = 3;
            timingFeedback.textContent = `ç¬¬ ${attempts + 1} / ${maxAttempts} æ¬¡`;

            function checkTiming() {
                if (attempts >= maxAttempts) return;
                
                const barRect = timingBar.getBoundingClientRect();
                const containerRect = timingBar.parentElement.getBoundingClientRect();
                const barPosition = (barRect.left - containerRect.left) / containerRect.width * 100;
                
                let score = 0;
                // ç»¿è‰²åŒºåŸŸæ˜¯ 40% åˆ° 60%
                if (barPosition >= 40 && barPosition <= 60) {
                    const distanceToCenter = Math.abs(barPosition - 50); // è·ç¦»ä¸­å¿ƒçš„è·ç¦»
                    score = Math.round(100 - distanceToCenter * 10); // è¶Šé è¿‘ä¸­å¿ƒåˆ†è¶Šé«˜
                    timingFeedback.textContent = `å®Œç¾! +${score}`;
                    synth.triggerAttackRelease("G5", "8n");
                } else {
                    timingFeedback.textContent = 'å¤±è¯¯!';
                    synth.triggerAttackRelease("C3", "8n");
                }
                totalScore += score;
                attempts++;
                
                if (attempts < maxAttempts) {
                    setTimeout(() => {
                        timingFeedback.textContent = `ç¬¬ ${attempts + 1} / ${maxAttempts} æ¬¡`;
                    }, 1000);
                } else {
                    timingBtn.removeEventListener('click', checkTiming);
                    scores.timing = Math.round(totalScore / maxAttempts);
                    setTimeout(startNextChallenge, 1500);
                }
            }
            
            timingBtn.addEventListener('click', checkTiming);
        }

        // --- é€šç”¨è®¡æ—¶å™¨ ---
        function runTimer(duration, onComplete) {
            clearInterval(timerInterval);
            let startTime = Date.now();
            timerInterval = setInterval(() => {
                const elapsedTime = Date.now() - startTime;
                const progress = 1 - (elapsedTime / duration);
                challengeTimerBar.style.width = `${Math.max(0, progress * 100)}%`;
                if (progress <= 0) {
                    clearInterval(timerInterval);
                    onComplete();
                }
            }, 50);
        }
        
        // --- æ˜¾ç¤ºåŠ è½½å¹¶è®¡ç®—ç»“æœ ---
        function showLoadingAndResults() {
            showPage('loading-page');
            let counter = 0;
            const texts = ["æ­£åœ¨åˆ†æä½ çš„è¿åŠ¨ç»†èƒ...", "åŒ¹é…å…¨çƒè¿åŠ¨æ•°æ®åº“...", "ä½ çš„æ½œèƒ½æŠ¥å‘Šå³å°†ç”Ÿæˆ!"];
            const loadingInterval = setInterval(() => {
                counter++;
                if (counter <= 2) {
                    loadingText.textContent = texts[counter];
                } else {
                    clearInterval(loadingInterval);
                    generateResult();
                    showPage('result-page');
                }
            }, 1200);
        }

        // --- ç”Ÿæˆç»“æœ ---
        function generateResult() {
            const totalScore = scores.agility + scores.endurance + scores.timing;
            let title, description, suggestion;

            if (totalScore > 250) {
                title = userType === 'child' ? "è¿åŠ¨å°è¶…äºº" : "åŸå¸‚ç‡ƒè„‚å…ˆé”‹";
                description = "ä½ çš„ç»¼åˆè¿åŠ¨æ½œèƒ½æé«˜ï¼Œåœ¨å„é¡¹æŒ‘æˆ˜ä¸­éƒ½è¡¨ç°å‡ºè‰²ï¼";
            } else if (totalScore > 180) {
                title = userType === 'child' ? "æ´»åŠ›å°å¥å°†" : "è¿åŠ¨æ½œåŠ›è‚¡";
                description = "ä½ çš„è¿åŠ¨å¤©èµ‹å¾ˆä¸é”™ï¼Œç¨åŠ è®­ç»ƒå°±èƒ½æˆä¸ºé«˜æ‰‹ï¼";
            } else {
                title = userType === 'child' ? "æˆé•¿å°èŒèŠ½" : "åŠå…¬å®¤ä¹…åæ—";
                description = "ä½ çš„è¿åŠ¨ç»†èƒæ­£åœ¨æ²‰ç¡ï¼Œæ˜¯æ—¶å€™å”¤é†’å®ƒä»¬äº†ï¼";
            }

            if (userType === 'child') {
                suggestion = `å­©å­çš„${scores.agility > 70 ? 'æ•æ·æ€§' : (scores.endurance > 70 ? 'è€åŠ›' : 'åè°ƒæ€§')}éå¸¸çªå‡ºï¼è¿™æ­£æ˜¯ç”Ÿé•¿å‘è‚²çš„é»„é‡‘æœŸã€‚ä¸“ä¸šçš„è·³ç»³è®­ç»ƒä¸ä»…èƒ½æœ‰æ•ˆæå‡èº«ä½“åè°ƒã€å¿ƒè‚ºåŠŸèƒ½ï¼Œæ›´èƒ½ä¿ƒè¿›èº«é«˜å‘è‚²ã€å¢å¼ºè‡ªä¿¡å¿ƒã€‚ç«‹å³é”å®šå…è´¹ä½“éªŒåé¢ï¼Œè®©ä¸“ä¸šæ•™ç»ƒä¸ºå­©å­è§„åˆ’æˆé•¿ç¬¬ä¸€æ­¥ï¼`;
            } else {
                suggestion = `ä½ çš„${scores.endurance > 70 ? 'è€åŠ›' : (scores.agility > 70 ? 'ååº”é€Ÿåº¦' : 'æ—¶æœºæŒæ§åŠ›')}å¾ˆæ£’ï¼æƒ³æ‰¾ä¸€ä¸ªæœ€é«˜æ•ˆçš„ç‡ƒè„‚æ–¹å¼å—ï¼Ÿ10åˆ†é’Ÿè·³ç»³æ¶ˆè€—çš„å¡è·¯é‡Œçº¦ç­‰äº30åˆ†é’Ÿæ…¢è·‘ã€‚åˆ«å†çŠ¹è±«äº†ï¼Œç«‹å³é¢„çº¦æˆ‘ä»¬çš„â€œæˆäººHIITç‡ƒè„‚è·³ç»³è¯¾â€ï¼Œå¿«é€Ÿå¡‘å½¢ï¼Œé‡Šæ”¾æ‰€æœ‰å·¥ä½œå‹åŠ›ï¼`;
            }
            
            resultTitle.textContent = title;
            resultDescription.textContent = description;
            resultSuggestion.textContent = suggestion;

            drawResultChart();
            
            // åŠ¨æ€åé¢å‡å°‘
            let spots = 7;
            spotsLeftEl.textContent = spots;
            setInterval(() => {
                if (spots > 3) {
                    spots--;
                    spotsLeftEl.textContent = spots;
                }
            }, 5000);
        }

        // --- ç»˜åˆ¶é›·è¾¾å›¾ ---
        let resultChartInstance;
        function drawResultChart() {
            const ctx = document.getElementById('result-chart').getContext('2d');
            if (resultChartInstance) {
                resultChartInstance.destroy();
            }
            resultChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['æ•æ·', 'è€åŠ›', 'æ—¶æœº', 'åè°ƒ', 'åŠ›é‡'],
                    datasets: [{
                        label: 'æˆ‘çš„è¿åŠ¨æ½œèƒ½',
                        data: [
                            scores.agility, 
                            scores.endurance, 
                            scores.timing,
                            (scores.agility + scores.timing) / 2, // åè°ƒåˆ†ç”±æ•æ·å’Œæ—¶æœºç»¼åˆ
                            (scores.endurance + scores.timing) / 2.2 // åŠ›é‡åˆ†ç”±è€åŠ›å’Œæ—¶æœºç»¼åˆ
                        ],
                        backgroundColor: 'rgba(251, 146, 60, 0.2)',
                        borderColor: 'rgba(251, 146, 60, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(251, 146, 60, 1)'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(255, 255, 255, 0.2)' },
                            grid: { color: 'rgba(255, 255, 255, 0.2)' },
                            pointLabels: { color: 'white', font: { size: 14 } },
                            ticks: {
                                color: 'white',
                                backdropColor: 'transparent',
                                stepSize: 25
                            },
                            min: 0,
                            max: 100
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    }
                }
            });
        }

        // --- äº‹ä»¶ç›‘å¬ ---
        startBtn.addEventListener('click', () => {
            initAudio(); // ç”¨æˆ·äº¤äº’åæ‰èƒ½åˆå§‹åŒ–éŸ³é¢‘
            synth.triggerAttackRelease("C4", "8n");
            showPage('choice-page');
        });

        choiceBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                synth.triggerAttackRelease("E4", "8n");
                userType = btn.dataset.type;
                showPage('challenge-page');
                startNextChallenge();
            });
        });

        // è¥é”€å¼¹çª—äº‹ä»¶ç›‘å¬
        openLeadFormBtn.addEventListener('click', () => toggleModal(leadFormModal, true));
        closeLeadModalBtn.addEventListener('click', () => toggleModal(leadFormModal, false));
        openShareModalBtn.addEventListener('click', () => toggleModal(shareModal, true));
        closeShareModalBtn.addEventListener('click', () => toggleModal(shareModal, false));
        closeSuccessModalBtn.addEventListener('click', () => toggleModal(leadFormModal, false));
        
        submitLeadBtn.addEventListener('click', () => {
            const name = document.getElementById('user-name').value;
            const phone = document.getElementById('user-phone').value;
            if (!name || !phone) {
                alert('è¯·å¡«å†™å®Œæ•´çš„å§“åå’Œæ‰‹æœºå·');
                return;
            }
            if (!/^1[3-9]\d{9}$/.test(phone)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·ç ');
                return;
            }
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šç”¨fetch APIå°†æ•°æ®å‘é€åˆ°æœåŠ¡å™¨
            console.log('æ”¶é›†åˆ°çº¿ç´¢:', { name, phone });

            // æ˜¾ç¤ºæˆåŠŸç•Œé¢
            formView.classList.add('hidden');
            successView.classList.remove('hidden');
        });

    </script>
</body>
</html>

